# =============================================================================
# LichtFeld Stats Collector Worker
# =============================================================================
#
# This Worker runs on a daily schedule to collect download statistics
# from the GitHub API and store them in the D1 database.
#
# Deployment:
#   cd workers/stats-collector
#   npx wrangler deploy
#
# Local Testing:
#   npx wrangler dev --test-scheduled
#   curl "http://localhost:8787/__scheduled?cron=0+2+*+*+*"
#
# =============================================================================

name = "lichtfeld-stats-collector"
main = "src/index.ts"
compatibility_date = "2026-01-28"

# -----------------------------------------------------------------------------
# D1 Database Binding
# -----------------------------------------------------------------------------
# Shared database with the stats-api Worker.
# Create with: npx wrangler d1 create lichtfeld-stats
# Then update the database_id below.

[[d1_databases]]
binding = "STATS_DB"
database_name = "lichtfeld-stats"
database_id = "8e58f2af-6fff-4e6d-89b4-8aa02f719c01"

# -----------------------------------------------------------------------------
# Cron Triggers
# -----------------------------------------------------------------------------
# Runs daily at 02:00 UTC to capture the previous day's download data.
# GitHub's traffic data updates hourly, so 2 AM gives us complete previous day stats.

[triggers]
crons = ["0 2 * * *"]

# -----------------------------------------------------------------------------
# Environment Variables
# -----------------------------------------------------------------------------
# Non-sensitive configuration values.
# For GITHUB_TOKEN, use: npx wrangler secret put GITHUB_TOKEN

# Production config
[vars]
GITHUB_OWNER = "MrNeRF"
GITHUB_REPO = "LichtFeld-Studio"

# For local testing with a repo that has releases, override with:
#   wrangler dev --var GITHUB_OWNER:cli --var GITHUB_REPO:cli
